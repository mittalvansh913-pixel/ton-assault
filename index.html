<script>
/* ========= GAME STATE ========= */
const gameState = {
  coins: 0,
  level: 1,
  coinsPerTap: 1,
  totalTaps: 0,
  totalEarned: 0,
  playerName: "Player",
  lastDaily: 0
};

/* ========= ELEMENTS ========= */
const loadingScreen = document.getElementById("loadingScreen");
const container = document.querySelector(".container");
const coinsEl = document.getElementById("coins");
const levelEl = document.getElementById("level");
const tapCoin = document.getElementById("tapCoin");
const perSecondEl = document.getElementById("perSecond");
const toast = document.getElementById("toast");

/* ========= MODALS ========= */
const modals = {
  profile: document.getElementById("profileModal"),
  daily: document.getElementById("dailyModal"),
  wheel: document.getElementById("wheelModal"),
  withdraw: document.getElementById("withdrawModal")
};

/* ========= INIT ========= */
function init() {
  loadGame();
  bindEvents();

  setTimeout(() => {
    loadingScreen.style.display = "none";
    container.style.display = "flex";
    updateUI();
  }, 2000);
}

/* ========= EVENTS ========= */
function bindEvents() {
  tapCoin.addEventListener("click", tap);

  document.getElementById("profileBtn").onclick = () => openModal("profile");
  document.getElementById("dailyBtn").onclick = () => openModal("daily");
  document.getElementById("wheelBtn").onclick = () => openModal("wheel");
  document.getElementById("withdrawBtn").onclick = () => openModal("withdraw");

  document.querySelectorAll(".close-btn").forEach(btn => {
    btn.onclick = () => closeAll();
  });

  document.getElementById("saveProfile").onclick = saveProfile;
  document.getElementById("claimDaily").onclick = claimDaily;
  document.getElementById("spinBtn").onclick = spinWheel;
  document.getElementById("withdrawBtnAction").onclick = withdrawDemo;
}

/* ========= CORE ========= */
function tap() {
  gameState.coins += gameState.coinsPerTap;
  gameState.totalTaps++;
  gameState.totalEarned++;

  if (gameState.coins >= gameState.level * 50) {
    gameState.level++;
    showToast("ðŸ”¥ Level Up!");
  }
  updateUI();
}

function updateUI() {
  coinsEl.textContent = gameState.coins;
  levelEl.textContent = gameState.level;
  perSecondEl.textContent = "0 coins/sec";
  document.getElementById("availableCoins").textContent = gameState.coins;
  document.getElementById("totalEarned").textContent = gameState.totalEarned;
  document.getElementById("totalTaps").textContent = gameState.totalTaps;
}

/* ========= DAILY ========= */
function claimDaily() {
  const now = Date.now();
  if (now - gameState.lastDaily < 86400000) {
    showToast("âŒ Come tomorrow");
    return;
  }
  gameState.coins += 100;
  gameState.lastDaily = now;
  saveGame();
  updateUI();
  closeAll();
  showToast("ðŸŽ +100 Coins");
}

/* ========= SPIN ========= */
function spinWheel() {
  if (gameState.coins < 1) {
    showToast("âŒ Need 1 coin");
    return;
  }
  gameState.coins--;
  const wheel = document.getElementById("wheel");
  const reward = [5, 10, 20, 50][Math.floor(Math.random() * 4)];
  const deg = 1080 + Math.random() * 360;

  wheel.style.transform = `rotate(${deg}deg)`;

  setTimeout(() => {
    gameState.coins += reward;
    document.getElementById("wheelResult").textContent =
      "ðŸŽ‰ You won " + reward + " coins";
    updateUI();
  }, 3000);
}

/* ========= PROFILE ========= */
function saveProfile() {
  const name = document.getElementById("playerName").value || "Player";
  gameState.playerName = name;
  saveGame();
  closeAll();
  showToast("âœ… Profile Saved");
}

/* ========= WITHDRAW ========= */
function withdrawDemo() {
  if (gameState.coins < 2) {
    alert("Minimum withdraw 2 coins");
    return;
  }
  alert("Withdraw DEMO\nFee 50%");
}

/* ========= MODAL ========= */
function openModal(key) {
  closeAll();
  modals[key].style.display = "flex";
}

function closeAll() {
  Object.values(modals).forEach(m => m.style.display = "none");
}

/* ========= STORAGE ========= */
function saveGame() {
  localStorage.setItem("ton_assault", JSON.stringify(gameState));
}

function loadGame() {
  const data = localStorage.getItem("ton_assault");
  if (data) Object.assign(gameState, JSON.parse(data));
}

/* ========= TOAST ========= */
function showToast(msg) {
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2000);
}

/* ========= START ========= */
document.addEventListener("DOMContentLoaded", init);
    </script>
