<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zombie Fighter</title>

<style>
body{
margin:0;font-family:Arial;color:#fff;overflow:hidden;
background:linear-gradient(#2b1055,#1a043a);
}

/* BACKGROUND */
.bg span{
position:fixed;width:10px;height:10px;
background:rgba(255,255,255,0.15);
border-radius:50%;
animation:float 15s linear infinite;
}
@keyframes float{
from{transform:translateY(110vh)}
to{transform:translateY(-10vh)}
}

.container{max-width:420px;margin:auto;padding:15px;text-align:center;position:relative;z-index:5}
.top{background:rgba(0,0,0,.4);border-radius:12px;padding:12px;display:flex;justify-content:space-between}
.stat{font-weight:bold;font-size:13px}

.bar{background:#444;border-radius:8px;overflow:hidden;height:10px;margin-top:5px}
.bar div{height:100%;transition:width 0.3s}

/* ‚ú® NEW: XP Bar styling */
.xp-bar-container{margin:5px 0}
.xp-bar{background:#444;border-radius:8px;overflow:hidden;height:8px;margin-top:3px}
.xp-bar div{height:100%;background:linear-gradient(90deg, #ffc107, #ff9800);transition:width 0.5s}

/* ‚ú® NEW: Energy Bar styling */
.energy-bar-container{margin:5px 0}
.energy-bar{background:#444;border-radius:8px;overflow:hidden;height:8px;margin-top:3px}
.energy-bar div{height:100%;background:linear-gradient(90deg, #00ff88, #00ccff);transition:width 0.5s}

.game{background:rgba(0,0,0,.4);border-radius:12px;padding:20px;margin:10px 0}
.fighters{font-size:48px;display:flex;justify-content:space-between;align-items:center}

#playerChar.attack{animation:attack .2s}
#zombieChar.hit{animation:hit .2s}

/* ‚ú® NEW: Character icon styling */
.character-icon{
font-size:48px;
width:60px;
height:60px;
display:flex;
align-items:center;
justify-content:center;
}
.ninja-icon{
width:60px;
height:60px;
object-fit:contain;
}

/* ‚ú® NEW: Screen shake on crit */
.game.shake{animation:shake 0.3s}
@keyframes shake{
0%, 100%{transform:translateX(0)}
25%{transform:translateX(-5px)}
75%{transform:translateX(5px)}
}

/* ‚ú® NEW: Level up glow effect */
.game.levelup{animation:levelupGlow 0.8s}
@keyframes levelupGlow{
0%, 100%{box-shadow:0 0 0 rgba(255,193,7,0)}
50%{box-shadow:0 0 30px rgba(255,193,7,0.8)}
}

/* ‚ú® NEW: Low HP warning */
.hp-low{animation:hpWarning 1s infinite}
@keyframes hpWarning{
0%, 100%{color:#fff}
50%{color:#ff5252}
}

@keyframes attack{50%{transform:translateX(20px)}}
@keyframes hit{50%{transform:translateX(-15px)}}

button{padding:10px 20px;border:none;border-radius:10px;font-weight:bold;cursor:pointer;background:#1e88e5;color:#fff;font-size:16px}
button:active{transform:scale(0.95)}
button:disabled{opacity:0.5;cursor:not-allowed}

/* SIDE MENUS */
.side-menu{position:fixed;top:30%;display:flex;flex-direction:column;gap:10px;z-index:99}
.side-menu.left{left:10px}
.side-menu.right{right:10px}
.side-btn{
width:50px;height:50px;border-radius:50%;
background:#1e88e5;color:#fff;
display:flex;align-items:center;justify-content:center;
font-size:20px;cursor:pointer;
box-shadow:0 4px 8px rgba(0,0,0,0.3);
}
.side-btn:active{transform:scale(0.9)}

/* MODALS */
.modal{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.85);
display:none;align-items:center;justify-content:center;z-index:200;
overflow-y:auto;padding:20px;box-sizing:border-box;
}
.modal.show{display:flex}
.modal-box{
background:#1a1a2e;padding:20px;border-radius:12px;width:100%;max-width:380px;
max-height:90vh;overflow-y:auto;
}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
.modal-header h2{margin:0;font-size:20px}
.close-btn{background:#ff5252;color:#fff;border:none;padding:5px 15px;border-radius:8px;cursor:pointer;font-size:18px}

/* ITEM CARDS */
.item-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.item-card{
background:rgba(255,255,255,0.05);border-radius:10px;padding:15px;
border:2px solid #444;position:relative;
}
.item-card.owned{border-color:#4caf50}
.item-card.equipped{border-color:#ffc107;background:rgba(255,193,7,0.1)}
.item-card .icon{font-size:40px}
.item-card .name{font-weight:bold;margin:5px 0}
.item-card .desc{font-size:12px;color:#aaa}
.item-card .price{color:#ffc107;margin-top:8px}
.item-card button{padding:6px 12px;font-size:12px;margin-top:8px;width:100%}
.item-card .badge{
position:absolute;top:5px;right:5px;
background:#ffc107;color:#000;padding:2px 6px;
border-radius:5px;font-size:10px;font-weight:bold;
}

/* SKILL ITEMS */
.skill-item{
background:rgba(255,255,255,0.05);border-radius:10px;padding:12px;
border:2px solid #444;margin-bottom:10px;
}
.skill-item .skill-header{display:flex;justify-content:space-between;align-items:center}
.skill-item .skill-name{font-weight:bold;font-size:16px}
.skill-item .skill-level{color:#4caf50;font-size:14px}
.skill-item .skill-desc{font-size:13px;color:#aaa;margin:5px 0}
.skill-item button{padding:6px 12px;font-size:12px;width:100%;margin-top:5px}

/* STATS PAGE */
.stat-row{
display:flex;justify-content:space-between;
background:rgba(255,255,255,0.05);padding:12px;
border-radius:8px;margin-bottom:8px;
}
.stat-row .label{color:#aaa}
.stat-row .value{font-weight:bold;color:#4caf50}

/* VIP TIER STYLES */
.vip-tier{
background:rgba(255,255,255,0.05);
border-radius:10px;
padding:15px;
margin-bottom:10px;
border:2px solid #444;
}
.vip-tier.active{
border-color:#ffc107;
background:rgba(255,193,7,0.1);
}
.vip-tier-header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:10px;
}
.vip-tier-name{
font-weight:bold;
font-size:18px;
}
.vip-tier-bonus{
color:#4caf50;
font-size:14px;
}
.vip-tier-price{
color:#ffc107;
font-weight:bold;
}
.vip-tier-desc{
font-size:12px;
color:#aaa;
margin-top:8px;
}

/* SETTINGS */
.setting-item{
background:rgba(255,255,255,0.05);padding:12px;
border-radius:8px;margin-bottom:10px;
}
.setting-item label{display:flex;justify-content:space-between;align-items:center}
.setting-item input[type="text"]{
width:100%;padding:8px;border-radius:6px;border:1px solid #444;
background:#0f0f1e;color:#fff;margin-top:5px;
}
.setting-item input[type="checkbox"]{
width:40px;height:20px;cursor:pointer;
}

/* REFERRAL */
.referral-code{
background:rgba(255,255,255,0.1);padding:15px;
border-radius:8px;text-align:center;margin:10px 0;
}
.referral-code .code{
font-size:24px;font-weight:bold;letter-spacing:2px;
color:#ffc107;margin:10px 0;
}

/* ‚ú® NEW: SPIN WHEEL STYLES */
.wheel-container{
position:relative;
width:280px;
height:280px;
margin:20px auto;
}
.wheel{
width:100%;
height:100%;
border-radius:50%;
position:relative;
overflow:hidden;
box-shadow:0 0 20px rgba(255,193,7,0.5);
transition:transform 3s cubic-bezier(0.17, 0.67, 0.12, 0.99);
}
.wheel-slice{
position:absolute;
width:50%;
height:50%;
transform-origin:100% 100%;
clip-path:polygon(0 0, 100% 0, 100% 100%);
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
font-size:18px;
}
.wheel-pointer{
position:absolute;
top:-10px;
left:50%;
transform:translateX(-50%);
width:0;
height:0;
border-left:15px solid transparent;
border-right:15px solid transparent;
border-top:25px solid #ff5252;
z-index:10;
}
.wheel-center{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%, -50%);
width:60px;
height:60px;
background:#1a1a2e;
border-radius:50%;
border:3px solid #ffc107;
display:flex;
align-items:center;
justify-content:center;
font-size:24px;
z-index:5;
}
.wheel-center img{
width:50px;
height:50px;
object-fit:contain;
}
.spin-result{
font-size:20px;
font-weight:bold;
color:#ffc107;
margin-top:15px;
min-height:30px;
}

/* FLOAT DAMAGE */
.float{
position:absolute;
color:#ff5252;
font-weight:bold;
font-size:20px;
animation:floatUp 1s forwards;
pointer-events:none;
}
@keyframes floatUp{
to{transform:translateY(-40px);opacity:0}
}

/* TOAST */
#toast{
position:fixed;bottom:80px;left:50%;
transform:translateX(-50%);
background:#000;padding:10px 20px;border-radius:20px;
opacity:0;transition:.3s;z-index:300;
}
#toast.show{opacity:1}

/* BOTTOM MENU */
.bottom-menu{
position:fixed;
bottom:0;left:0;width:100%;
background:rgba(0,0,0,.7);
border-top:2px solid #555;
display:flex;
justify-content:space-around;
padding:8px 0;
z-index:150;
}
.bottom-btn{
flex:1;margin:0 6px;
border:1px solid #666;
border-radius:12px;
background:#111;
padding:6px 0;
text-align:center;
font-size:14px;
cursor:pointer;
}
.bottom-btn:active{background:#222}

/* CONFIRM DIALOG */
.confirm-dialog{
background:#1a1a2e;padding:20px;border-radius:12px;
text-align:center;max-width:300px;
}
.confirm-dialog h3{margin-top:0}
.confirm-dialog .buttons{display:flex;gap:10px;margin-top:15px}
.confirm-dialog button{flex:1;padding:10px}
</style>
</head>

<body>

<div class="bg">
<script>
for(let i=0;i<40;i++){
document.write(`<span style="left:${Math.random()*100}%;animation-delay:${Math.random()*10}s"></span>`);
}
</script>
</div>

<div class="container">
<div class="top">
<div class="stat">üë§ <span id="playerName">Player</span></div>
<div class="stat">‚≠ê <span id="level">1</span></div>
<div class="stat">üí∞ <span id="coins">0</span> | üíé <span id="gems">0</span></div>
</div>

<!-- ‚ú® NEW: XP Progress Bar -->
<div class="xp-bar-container">
‚ö° XP <span id="xp">0</span>/<span id="xpmax">100</span>
<div class="xp-bar"><div id="xpbar" style="width:0%;background:linear-gradient(90deg, #ffc107, #ff9800)"></div></div>
</div>

<div id="hpContainer">
<span id="hpLabel">‚ù§Ô∏è HP</span> <span id="hp">100</span>/<span id="hpmax">100</span>
<div class="bar"><div id="hpbar" style="width:100%;background:red"></div></div>
</div>

<!-- ‚ú® NEW: Energy Progress Bar -->
<div class="energy-bar-container">
‚ö° Energy <span id="energy">100</span>/<span id="energymax">100</span>
<div class="energy-bar"><div id="energybar" style="width:100%;background:linear-gradient(90deg, #00ff88, #00ccff)"></div></div>
</div>

<div class="game" id="gameContainer">
<div class="fighters">
<div id="playerChar" class="character-icon">ü¶∏‚Äç‚ôÇÔ∏è</div> ‚öîÔ∏è <div id="zombieChar">üßü</div>
</div>
<div id="zhp">30/30</div>
<div class="bar"><div id="zbar" style="width:100%;background:green"></div></div>
</div>

<button id="attackButton" onclick="attack()">‚öîÔ∏è Attack</button>
</div>

<!-- SIDE MENUS -->
<div class="side-menu left">
<div class="side-btn" onclick="watchAd()">üì∫</div>
<div class="side-btn" onclick="daily()">üéÅ</div>
<div class="side-btn" onclick="openReferral()">üë•</div>
<div class="side-btn" onclick="openSpinWheel()">üé°</div>
</div>

<div class="side-menu right">
<div class="side-btn" onclick="openWeapons()">‚öîÔ∏è</div>
<!-- ‚ú® FEATURE 2: Replaced Characters and Skills with VIP and Inventory -->
<div class="side-btn" onclick="openVIP()">üëë</div>
<div class="side-btn" onclick="openInventory()">üéí</div>
<div class="side-btn" onclick="openStats()">üìä</div>
<div class="side-btn" onclick="openSettings()">‚öôÔ∏è</div>
</div>

<!-- BOTTOM MENU -->
<div class="bottom-menu">
<div class="bottom-btn" onclick="openWeapons()">‚öîÔ∏è Weapons</div>
<div class="bottom-btn" onclick="openCharacters()">üßô Characters</div>
<div class="bottom-btn" onclick="openSkills()">‚ú® Skills</div>
</div>

<!-- WEAPONS MODAL -->
<div id="weaponsModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>‚öîÔ∏è Weapons</h2>
<button class="close-btn" onclick="closeModal('weaponsModal')">‚úï</button>
</div>
<div id="weaponsList" class="item-grid"></div>
</div>
</div>

<!-- CHARACTERS MODAL -->
<div id="charactersModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>üßô Characters</h2>
<button class="close-btn" onclick="closeModal('charactersModal')">‚úï</button>
</div>
<div id="charactersList" class="item-grid"></div>
</div>
</div>

<!-- SKILLS MODAL -->
<div id="skillsModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>‚ú® Skills & Upgrades</h2>
<button class="close-btn" onclick="closeModal('skillsModal')">‚úï</button>
</div>
<div id="skillsList"></div>
</div>
</div>

<!-- ‚ú® NEW: VIP MODAL -->
<div id="vipModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>üëë VIP System</h2>
<button class="close-btn" onclick="closeModal('vipModal')">‚úï</button>
</div>
<div id="vipList"></div>
<div style="margin-top:20px;padding:10px;background:rgba(255,215,0,0.1);border-radius:8px;">
<p style="font-size:12px;color:#aaa;">üí° VIP Bonus applies to: Kills, Ads, Daily Rewards</p>
<p style="font-size:12px;color:#aaa;">Current VIP Bonus: <span id="currentVIPBonus">0%</span></p>
</div>
</div>
</div>

<!-- ‚ú® NEW: INVENTORY MODAL -->
<div id="inventoryModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>üéí Inventory</h2>
<button class="close-btn" onclick="closeModal('inventoryModal')">‚úï</button>
</div>
<div id="inventoryList">
<p style="text-align:center;color:#aaa;">Inventory items will appear here</p>
</div>
</div>
</div>

<!-- STATS MODAL -->
<div id="statsModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>üìä Statistics</h2>
<button class="close-btn" onclick="closeModal('statsModal')">‚úï</button>
</div>
<div id="statsList"></div>
</div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>‚öôÔ∏è Settings</h2>
<button class="close-btn" onclick="closeModal('settingsModal')">‚úï</button>
</div>
<div id="settingsList"></div>
</div>
</div>

<!-- REFERRAL MODAL -->
<div id="referralModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>üë• Referrals</h2>
<button class="close-btn" onclick="closeModal('referralModal')">‚úï</button>
</div>
<div id="referralContent"></div>
</div>
</div>

<!-- ‚ú® NEW: SPIN WHEEL MODAL -->
<div id="spinModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>üé° Spin the Wheel</h2>
<button class="close-btn" onclick="closeModal('spinModal')">‚úï</button>
</div>
<div class="wheel-container">
<div class="wheel-pointer"></div>
<div class="wheel" id="wheel"></div>
<div class="wheel-center">
<!-- ‚ú® FEATURE 5: Ninja image in wheel center -->
<img id="wheelCenterImage" src="https://api.dicebear.com/7.x/adventurer/svg?seed=ninja&backgroundColor=1a1a2e" alt="Ninja">
</div>
</div>
<div class="spin-result" id="spinResult"></div>
<button id="spinButton" onclick="spinWheel()" style="width:100%;padding:12px;margin-top:10px">
üé∞ SPIN (Free)
</button>
</div>
</div>

<!-- ‚ú® NEW: WITHDRAWAL MODAL -->
<div id="withdrawalModal" class="modal">
<div class="modal-box">
<div class="modal-header">
<h2>üí∞ Withdraw TON</h2>
<button class="close-btn" onclick="closeModal('withdrawalModal')">‚úï</button>
</div>
<div style="padding:15px;">
<div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;margin-bottom:15px;">
<h3 style="margin-top:0;color:#ffc107;">Withdrawal Rules</h3>
<p style="font-size:14px;color:#aaa;">‚Ä¢ Minimum: <strong>20 TON</strong></p>
<p style="font-size:14px;color:#aaa;">‚Ä¢ Fee: <strong>25%</strong></p>
<p style="font-size:14px;color:#aaa;">‚Ä¢ Network: TON Blockchain</p>
</div>
<div style="margin-bottom:15px;">
<label style="display:block;margin-bottom:5px;">Amount to Withdraw (TON):</label>
<input type="number" id="withdrawAmount" min="20" step="1" value="20" style="width:100%;padding:10px;border-radius:8px;background:#0f0f1e;border:1px solid #444;color:#fff;">
</div>
<div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;margin-bottom:15px;">
<h4 style="margin-top:0;color:#4caf50;">Summary</h4>
<p style="font-size:14px;">Requested: <span id="requestedAmount">20</span> TON</p>
<p style="font-size:14px;">Fee (25%): <span id="feeAmount">5</span> TON</p>
<p style="font-size:16px;font-weight:bold;color:#ffc107;">You receive: <span id="finalAmount">15</span> TON</p>
</div>
<button onclick="processWithdrawal()" style="width:100%;padding:12px;background:#4caf50;color:#fff;border:none;border-radius:8px;font-weight:bold;">
üí∏ Request Withdrawal
</button>
</div>
</div>
</div>

<!-- CONFIRM DIALOG -->
<div id="confirmModal" class="modal">
<div class="confirm-dialog">
<h3>‚ö†Ô∏è Reset Game?</h3>
<p>This will delete all progress!</p>
<div class="buttons">
<button onclick="closeModal('confirmModal')">Cancel</button>
<button onclick="confirmReset()" style="background:#ff5252">Reset</button>
</div>
</div>
</div>

<div id="toast"></div>

<script>
// ‚ú® NEW: Sound Effects System
const sounds = {
attack: null,
hit: null,
death: null,
coin: null,
levelup: null,
spin: null
};

// Initialize sound effects (using data URIs for lightweight sounds)
function initSounds(){
// Simple beep sounds using Web Audio API
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

sounds.play = function(type){
if(!player.soundEnabled) return;

const ctx = audioContext;
const oscillator = ctx.createOscillator();
const gainNode = ctx.createGain();

oscillator.connect(gainNode);
gainNode.connect(ctx.destination);

switch(type){
case 'attack':
oscillator.frequency.value = 300;
gainNode.gain.value = 0.1;
oscillator.start();
oscillator.stop(ctx.currentTime + 0.1);
break;
case 'hit':
oscillator.frequency.value = 150;
gainNode.gain.value = 0.15;
oscillator.start();
oscillator.stop(ctx.currentTime + 0.15);
break;
case 'death':
oscillator.frequency.value = 100;
gainNode.gain.value = 0.2;
oscillator.start();
oscillator.stop(ctx.currentTime + 0.3);
break;
case 'coin':
oscillator.frequency.value = 800;
gainNode.gain.value = 0.08;
oscillator.start();
oscillator.stop(ctx.currentTime + 0.1);
break;
case 'levelup':
oscillator.frequency.value = 600;
gainNode.gain.value = 0.12;
oscillator.start();
oscillator.stop(ctx.currentTime + 0.2);
setTimeout(() => {
const osc2 = ctx.createOscillator();
const gain2 = ctx.createGain();
osc2.connect(gain2);
gain2.connect(ctx.destination);
osc2.frequency.value = 800;
gain2.gain.value = 0.12;
osc2.start();
osc2.stop(ctx.currentTime + 0.2);
}, 100);
break;
case 'spin':
oscillator.frequency.value = 400;
gainNode.gain.value = 0.1;
oscillator.start();
oscillator.stop(ctx.currentTime + 0.05);
break;
}
};
}

// Initialize Telegram WebApp
let tg = window.Telegram?.WebApp;
if(tg){
tg.ready();
tg.expand();
}

// ‚ú® MODIFIED: Game State with XP system, HP upgrades, Energy, and VIP
let player = {
hp: 100,
max: 100,
baseMax: 100, // ‚ú® NEW: Base max HP before upgrades
hpUpgrades: 0, // ‚ú® NEW: Number of HP upgrades purchased
coins: 0,
gems: 0,
level: 1,
xp: 0, // ‚ú® NEW: Current XP
xpMax: 100, // ‚ú® NEW: XP needed for next level
energy: 100, // ‚ú® FEATURE 1: Energy system
energyMax: 100, // ‚ú® FEATURE 1: Max energy
weapon: "sword",
char: "hero",
name: "Player",
kills: 0,
coinsEarned: 0,
referrals: 0,
referralCode: "",
ownedWeapons: ["sword"],
ownedChars: ["hero"],
soundEnabled: true,
vipTier: 0, // ‚ú® FEATURE 3: VIP system (0 = no VIP, 1-4 = VIP tiers)
vipBonus: 0 // ‚ú® FEATURE 3: VIP bonus percentage
};

let zombie = {hp: 30, max: 30};

// Skills State
let skills = {
damage: {level: 0, max: 5},
hp: {level: 0, max: 5},
crit: {level: 0, max: 3}
};

// Weapons Data
let weapons = {
sword: {name: "Basic Sword", dmg: 10, price: 0, icon: "‚öîÔ∏è", desc: "Starter weapon"},
axe: {name: "Battle Axe", dmg: 20, price: 100, icon: "ü™ì", desc: "+10 damage"},
gun: {name: "Power Gun", dmg: 35, price: 300, icon: "üî´", desc: "+25 damage"},
laser: {name: "Laser Sword", dmg: 50, price: 600, icon: "üó°Ô∏è", desc: "+40 damage"},
hammer: {name: "Thunder Hammer", dmg: 75, price: 1000, icon: "üî®", desc: "+65 damage"}
};

// ‚ú® MODIFIED: Characters Data with Ninja image
let characters = {
hero: {name: "Hero", icon: "ü¶∏‚Äç‚ôÇÔ∏è", hp: 100, level: 1, price: 0, desc: "Balanced fighter"},
ninja: {name: "Ninja", icon: "ü•∑", image: "https://api.dicebear.com/7.x/adventurer/svg?seed=ninja&backgroundColor=1a1a2e", hp: 80, level: 5, price: 200, desc: "Fast attacks"},
slayer: {name: "Slayer", icon: "üßî‚Äç‚ôÇÔ∏è", hp: 150, level: 10, price: 500, desc: "High HP tank"},
wizard: {name: "Wizard", icon: "üßô‚Äç‚ôÇÔ∏è", hp: 90, level: 15, price: 800, desc: "Magic damage"},
knight: {name: "Knight", icon: "üõ°Ô∏è", hp: 200, level: 20, price: 1200, desc: "Ultimate defense"}
};

// ‚ú® NEW: VIP Tiers Data
const vipTiers = [
{id: 0, name: "No VIP", bonus: 0, price: 0, desc: "Standard earnings"},
{id: 1, name: "VIP 1", bonus: 10, price: 0.5, desc: "+10% coin earnings"},
{id: 2, name: "VIP 2", bonus: 25, price: 2.5, desc: "+25% coin earnings"},
{id: 3, name: "VIP 3", bonus: 50, price: 10, desc: "+50% coin earnings"},
{id: 4, name: "VIP 4", bonus: 100, price: 50, desc: "+100% coin earnings"}
];

// ‚ú® NEW: Spin wheel prizes
const wheelPrizes = [100, 50, 20, 10, 50, 0, 30, 20];
const wheelColors = ['#ffc107', '#4caf50', '#2196f3', '#9c27b0', '#ff9800', '#f44336', '#00bcd4', '#8bc34a'];
let isSpinning = false;

// ‚ú® FEATURE 1: Energy regeneration timer
let energyTimer = null;

// Load saved data
function loadGame(){
let saved = localStorage.getItem("zombieFighterSave");
if(saved){
let data = JSON.parse(saved);
Object.assign(player, data.player);
Object.assign(skills, data.skills);
// ‚ú® NEW: Ensure new properties exist
if(!player.xp) player.xp = 0;
if(!player.xpMax) player.xpMax = 100;
if(!player.baseMax) player.baseMax = 100;
if(!player.hpUpgrades) player.hpUpgrades = 0;
if(!player.energy) player.energy = 100;
if(!player.energyMax) player.energyMax = 100;
if(!player.vipTier) player.vipTier = 0;
if(!player.vipBonus) player.vipBonus = 0;
}
// Get Telegram username
if(tg && tg.initDataUnsafe?.user){
player.name = tg.initDataUnsafe.user.first_name || "Player";
}
// Generate referral code if not exists
if(!player.referralCode){
player.referralCode = "ZF" + Math.random().toString(36).substr(2, 6).toUpperCase();
}

// ‚ú® FEATURE 1: Start energy regeneration
startEnergyRegeneration();

// Update VIP bonus
updateVIPBonus();

update();
}

// Save game
function saveGame(){
localStorage.setItem("zombieFighterSave", JSON.stringify({
player: player,
skills: skills
}));
}

// ‚ú® FEATURE 1: Energy regeneration system
function startEnergyRegeneration() {
if (energyTimer) clearInterval(energyTimer);
energyTimer = setInterval(() => {
if (player.energy < player.energyMax) {
player.energy += 1;
updateEnergyUI();
saveGame();
}
}, 5000); // Every 5 seconds
}

// ‚ú® FEATURE 1: Update energy UI
function updateEnergyUI() {
const energyElement = document.getElementById('energy');
const energyMaxElement = document.getElementById('energymax');
const energyBar = document.getElementById('energybar');
const attackButton = document.getElementById('attackButton');
  
energyElement.textContent = player.energy;
energyMaxElement.textContent = player.energyMax;
energyBar.style.width = (player.energy / player.energyMax * 100) + "%";
  
// Disable attack button if not enough energy
if (player.energy < 5) {
attackButton.disabled = true;
} else {
attackButton.disabled = false;
}
}

// ‚ú® FEATURE 3: Update VIP bonus
function updateVIPBonus() {
const vipTier = vipTiers.find(tier => tier.id === player.vipTier);
if (vipTier) {
player.vipBonus = vipTier.bonus;
}
const currentVIPBonusElement = document.getElementById('currentVIPBonus');
if (currentVIPBonusElement) {
currentVIPBonusElement.textContent = player.vipBonus + "%";
}
}

// ‚ú® FEATURE 3: Apply VIP bonus to coin earnings
function applyVIPBonus(coins) {
if (player.vipBonus > 0) {
const bonusMultiplier = 1 + (player.vipBonus / 100);
return Math.floor(coins * bonusMultiplier);
}
return coins;
}

// ‚ú® MODIFIED: Update UI with XP bar, Energy bar and low HP warning
function update(){
hp.textContent = player.hp;
hpmax.textContent = player.max;
hpbar.style.width = (player.hp / player.max * 100) + "%";

// ‚ú® NEW: XP bar update
xp.textContent = player.xp;
xpmax.textContent = player.xpMax;
xpbar.style.width = (player.xp / player.xpMax * 100) + "%";

// ‚ú® NEW: Energy bar update
updateEnergyUI();

// ‚ú® NEW: Low HP warning
if(player.hp < player.max * 0.25){
hpLabel.classList.add('hp-low');
} else {
hpLabel.classList.remove('hp-low');
}

zhp.textContent = zombie.hp + "/" + zombie.max;
zbar.style.width = (zombie.hp / zombie.max * 100) + "%";
  
// ‚ú® FEATURE 5: Display character with image for ninja
const charData = characters[player.char];
if (player.char === 'ninja' && charData.image) {
playerChar.innerHTML = `<img src="${charData.image}" alt="Ninja" class="ninja-icon" style="width:60px;height:60px;">`;
} else {
playerChar.textContent = charData.icon;
}
  
coins.textContent = player.coins;
gems.textContent = player.gems;
level.textContent = player.level;
playerName.textContent = player.name;
saveGame();
}

// ‚ú® MODIFIED: Attack Function with Energy system and VIP bonus
function attack(){
if(player.hp <= 0){
toastMsg("‚ùå You are dead! Heal first!");
return;
}

// ‚ú® FEATURE 1: Check energy
if (player.energy < 5) {
toastMsg("‚ö° Not enough energy! Wait for regeneration.");
return;
}

// ‚ú® FEATURE 1: Consume energy
player.energy -= 5;
updateEnergyUI();

playerChar.classList.add("attack");
zombieChar.classList.add("hit");
sounds.play('attack');

// Calculate damage
let dmg = weapons[player.weapon].dmg;
dmg += skills.damage.level * 5;

// Critical hit chance
let isCrit = Math.random() < (skills.crit.level * 0.1);
if(isCrit){
dmg *= 2;
floatText("üí• CRIT -" + dmg, zombieChar);
sounds.play('hit');
// ‚ú® NEW: Screen shake on crit
gameContainer.classList.add('shake');
setTimeout(() => gameContainer.classList.remove('shake'), 300);
} else {
floatText("-" + dmg, zombieChar);
sounds.play('hit');
}

zombie.hp -= dmg;

if(zombie.hp <= 0){
player.kills++;

// ‚ú® NEW: XP-based leveling system
let xpGain = 20 + Math.floor(player.level * 2); // XP scales with level
player.xp += xpGain;
  
// ‚ú® FEATURE 3: Apply VIP bonus to coins
let coinGain = 10;
coinGain = applyVIPBonus(coinGain);
  
player.coins += coinGain;
player.coinsEarned += coinGain;
sounds.play('coin');

// Check for level up
if(player.xp >= player.xpMax){
player.xp -= player.xpMax;
player.level++;
// ‚ú® NEW: XP requirement increases gradually
player.xpMax = Math.floor(100 + (player.level * 15));
sounds.play('levelup');
toastMsg("üéâ LEVEL UP! Level " + player.level);
// ‚ú® NEW: Level up visual effect
gameContainer.classList.add('levelup');
setTimeout(() => gameContainer.classList.remove('levelup'), 800);
} else {
toastMsg(`+${xpGain}‚ö° +${coinGain}üí∞`);
}

sounds.play('death');
// ‚ú® NEW: Zombie difficulty scales more gradually
zombie.hp = zombie.max + Math.floor(player.level * 3);
zombie.max = zombie.hp;
}

// Zombie counter attack
setTimeout(() => {
let zombieDmg = 5 + Math.floor(player.level / 3);
player.hp = Math.max(0, player.hp - zombieDmg);
if(player.hp > 0){
floatText("-" + zombieDmg, playerChar);
}
if(player.hp === 0){
toastMsg("üíÄ You died! Watching ad to revive...");
setTimeout(() => {
player.hp = player.max;
update();
toastMsg("‚úÖ Revived!");
}, 2000);
}
update();
}, 400);

setTimeout(() => {
playerChar.classList.remove("attack");
zombieChar.classList.remove("hit");
}, 200);

update();
}

// Floating Damage Text
function floatText(text, el){
let d = document.createElement("div");
d.className = "float";
d.textContent = text;
d.style.left = (Math.random() * 30 + 35) + "%";
d.style.top = "50%";
el.parentElement.style.position = "relative";
el.parentElement.appendChild(d);
setTimeout(() => d.remove(), 1000);
}

// Toast Notification
function toastMsg(t){
toast.textContent = t;
toast.classList.add("show");
setTimeout(() => toast.classList.remove("show"), 2000);
}

// ‚ú® FEATURE 2: New modal functions for VIP and Inventory
function openVIP() {
const modal = document.getElementById('vipModal');
const vipList = document.getElementById('vipList');
vipList.innerHTML = '';

vipTiers.forEach(tier => {
if (tier.id === 0) return; // Skip "No VIP" tier
  
const div = document.createElement('div');
div.className = 'vip-tier';
if (player.vipTier === tier.id) {
div.classList.add('active');
}
  
div.innerHTML = `
<div class="vip-tier-header">
<div class="vip-tier-name">${tier.name}</div>
<div class="vip-tier-bonus">+${tier.bonus}% coins</div>
</div>
<div class="vip-tier-price">${tier.price} TON</div>
<div class="vip-tier-desc">${tier.desc}</div>
<button onclick="purchaseVIP(${tier.id})" style="width:100%;margin-top:10px;padding:8px;${player.vipTier === tier.id ? 'background:#4caf50' : 'background:#1e88e5'}">
${player.vipTier === tier.id ? '‚úÖ Active' : 'üëë Purchase'}
</button>
`;
vipList.appendChild(div);
});

modal.classList.add('show');
}

// ‚ú® FEATURE 3: VIP purchase function
function purchaseVIP(tierId) {
const tier = vipTiers.find(t => t.id === tierId);
if (!tier) return;

if (player.vipTier === tierId) {
toastMsg(`‚úÖ You already have ${tier.name}`);
return;
}

// In a real app, this would process a real payment
// For simulation, we'll just activate it
player.vipTier = tierId;
updateVIPBonus();
saveGame();
update();
toastMsg(`üéâ ${tier.name} activated! +${tier.bonus}% coin bonus!`);
openVIP(); // Refresh the modal
}

// ‚ú® FEATURE 2: Inventory modal
function openInventory() {
const modal = document.getElementById('inventoryModal');
const inventoryList = document.getElementById('inventoryList');
  
inventoryList.innerHTML = `
<div style="text-align:center;padding:20px;">
<h3 style="color:#ffc107;">Your Inventory</h3>
<p style="color:#aaa;margin-bottom:20px;">Items you've collected will appear here</p>
  
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
<div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;text-align:center;">
<div style="font-size:24px;">‚öîÔ∏è</div>
<div style="font-weight:bold;margin:5px 0;">Weapons</div>
<div style="font-size:12px;color:#4caf50;">${player.ownedWeapons.length} owned</div>
</div>
  
<div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;text-align:center;">
<div style="font-size:24px;">üßô</div>
<div style="font-weight:bold;margin:5px 0;">Characters</div>
<div style="font-size:12px;color:#4caf50;">${player.ownedChars.length} owned</div>
</div>
</div>
  
<div style="margin-top:20px;background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;">
<h4 style="margin-top:0;color:#ffc107;">VIP Status</h4>
<p style="color:#aaa;">Current Tier: <span style="color:#4caf50;font-weight:bold;">${vipTiers[player.vipTier].name}</span></p>
<p style="color:#aaa;">Coin Bonus: <span style="color:#4caf50;font-weight:bold;">+${player.vipBonus}%</span></p>
</div>
</div>
`;

modal.classList.add('show');
}

// ‚ú® FEATURE 4: Withdrawal functions
function updateWithdrawalSummary() {
const amount = parseInt(document.getElementById('withdrawAmount').value) || 20;
if (amount < 20) {
document.getElementById('withdrawAmount').value = 20;
updateWithdrawalSummary();
return;
}

const fee = amount * 0.25;
const final = amount - fee;

document.getElementById('requestedAmount').textContent = amount;
document.getElementById('feeAmount').textContent = fee.toFixed(2);
document.getElementById('finalAmount').textContent = final.toFixed(2);
}

function openWithdrawal() {
const modal = document.getElementById('withdrawalModal');
modal.classList.add('show');
updateWithdrawalSummary();
}

function processWithdrawal() {
const amount = parseInt(document.getElementById('withdrawAmount').value) || 20;
if (amount < 20) {
toastMsg("‚ùå Minimum withdrawal is 20 TON");
return;
}

const fee = amount * 0.25;
const final = amount - fee;

toastMsg(`‚úÖ Withdrawal request sent: ${final.toFixed(2)} TON (after 25% fee)`);
closeModal('withdrawalModal');
}

// ‚ú® FEATURE 5: Modified character display in characters modal
function openCharacters(){
const modal = document.getElementById('charactersModal');
const list = document.getElementById('charactersList');
list.innerHTML = "";

for(let id in characters){
let ch = characters[id];
let owned = player.ownedChars.includes(id);
let equipped = player.char === id;
let canBuy = player.level >= ch.level && player.coins >= ch.price;

let card = document.createElement("div");
card.className = "item-card";
if(owned) card.classList.add("owned");
if(equipped) card.classList.add("equipped");

// ‚ú® FEATURE 5: Use image for ninja character
let iconHTML = '';
if (id === 'ninja' && ch.image) {
iconHTML = `<img src="${ch.image}" alt="Ninja" style="width:40px;height:40px;object-fit:contain;">`;
} else {
iconHTML = `<div class="icon">${ch.icon}</div>`;
}

card.innerHTML = `
${iconHTML}
<div class="name">${ch.name}</div>
<div class="desc">${ch.desc}</div>
<div class="price">Level ${ch.level} | ${ch.price}üí∞</div>
${!owned ? 
`<button onclick="buyChar('${id}')" ${canBuy ? "" : "disabled"}>
${canBuy ? "Buy" : "Locked"}
</button>` :
`<button onclick="equipChar('${id}')" ${!equipped ? "" : "disabled"}>
${equipped ? "EQUIPPED" : "Equip"}
</button>`
}
${owned ? '<div class="badge">OWNED</div>' : ''}
${equipped ? '<div class="badge">EQUIPPED</div>' : ''}
`;
list.appendChild(card);
}
modal.classList.add("show");
}

// ‚ú® FEATURE 5: Modified character equip function to handle images
function equipChar(id){
player.char = id;
update();
toastMsg(`‚úÖ Equipped ${characters[id].name}`);
openCharacters();
}

// Open/Close Modals
function openModal(id){
document.getElementById(id).classList.add("show");
}

function closeModal(id){
document.getElementById(id).classList.remove("show");
}

// ‚ú® FEATURE 4: Modified watchAd function to include VIP bonus
function watchAd(){
// ‚ú® FEATURE 3: Apply VIP bonus to ad rewards
let adReward = 50;
adReward = applyVIPBonus(adReward);
  
player.coins += adReward;
player.coinsEarned += adReward;
update();
toastMsg(`üì∫ +${adReward} coins from ad!${player.vipBonus > 0 ? ` (VIP +${player.vipBonus}%)` : ''}`);
}

// ‚ú® FEATURE 4: Modified daily function to include VIP bonus
function daily(){
// ‚ú® FEATURE 3: Apply VIP bonus to daily rewards
let dailyReward = 100;
dailyReward = applyVIPBonus(dailyReward);
  
player.coins += dailyReward;
player.coinsEarned += dailyReward;
update();
toastMsg(`üéÅ +${dailyReward} daily coins!${player.vipBonus > 0 ? ` (VIP +${player.vipBonus}%)` : ''}`);
}

// Other existing functions (unchanged but kept for completeness)
function openWeapons(){
const modal = document.getElementById('weaponsModal');
const list = document.getElementById('weaponsList');
list.innerHTML = "";

for(let id in weapons){
let w = weapons[id];
let owned = player.ownedWeapons.includes(id);
let equipped = player.weapon === id;

let card = document.createElement("div");
card.className = "item-card";
if(owned) card.classList.add("owned");
if(equipped) card.classList.add("equipped");

card.innerHTML = `
<div class="icon">${w.icon}</div>
<div class="name">${w.name}</div>
<div class="desc">${w.desc}</div>
<div class="price">${w.price}üí∞</div>
${!owned ? 
`<button onclick="buyWeapon('${id}')" ${player.coins >= w.price ? "" : "disabled"}>
${player.coins >= w.price ? "Buy" : "Need Coins"}
</button>` :
`<button onclick="equipWeapon('${id}')" ${!equipped ? "" : "disabled"}>
${equipped ? "EQUIPPED" : "Equip"}
</button>`
}
${owned ? '<div class="badge">OWNED</div>' : ''}
${equipped ? '<div class="badge">EQUIPPED</div>' : ''}
`;
list.appendChild(card);
}
modal.classList.add("show");
}

function buyWeapon(id){
let w = weapons[id];
if(player.coins >= w.price){
player.coins -= w.price;
player.ownedWeapons.push(id);
update();
toastMsg(`‚úÖ Bought ${w.name}!`);
openWeapons();
} else {
toastMsg("‚ùå Not enough coins!");
}
}

function equipWeapon(id){
player.weapon = id;
update();
toastMsg(`‚úÖ Equipped ${weapons[id].name}`);
openWeapons();
}

function buyChar(id){
let ch = characters[id];
if(player.level >= ch.level && player.coins >= ch.price){
player.coins -= ch.price;
player.ownedChars.push(id);
update();
toastMsg(`‚úÖ Unlocked ${ch.name}!`);
openCharacters();
} else if(player.level < ch.level){
toastMsg(`‚ùå Need level ${ch.level}!`);
} else {
toastMsg("‚ùå Not enough coins!");
}
}

function openSkills(){
const modal = document.getElementById('skillsModal');
const list = document.getElementById('skillsList');
list.innerHTML = "";

let skillData = [
{id: "damage", name: "Damage Boost", desc: "Increase attack damage by +5 per level", priceBase: 100, level: skills.damage.level, max: skills.damage.max},
{id: "hp", name: "Max HP", desc: "Increase max HP by +20 per level", priceBase: 150, level: skills.hp.level, max: skills.hp.max},
{id: "crit", name: "Critical Chance", desc: "Increase critical hit chance by +10% per level", priceBase: 200, level: skills.crit.level, max: skills.crit.max}
];

skillData.forEach(s => {
let price = s.priceBase * (s.level + 1);
let div = document.createElement("div");
div.className = "skill-item";
div.innerHTML = `
<div class="skill-header">
<div class="skill-name">${s.name}</div>
<div class="skill-level">Level ${s.level}/${s.max}</div>
</div>
<div class="skill-desc">${s.desc}</div>
<button onclick="upgradeSkill('${s.id}')" ${s.level < s.max && player.coins >= price ? "" : "disabled"}>
${s.level >= s.max ? "MAXED" : `Upgrade - ${price}üí∞`}
</button>
`;
list.appendChild(div);
});

modal.classList.add("show");
}

function upgradeSkill(id){
let skill = skills[id];
let price = 0;
if(id === "damage") price = 100 * (skill.level + 1);
else if(id === "hp") price = 150 * (skill.level + 1);
else if(id === "crit") price = 200 * (skill.level + 1);

if(skill.level >= skill.max){
toastMsg("‚ùå Skill already maxed!");
return;
}
if(player.coins >= price){
player.coins -= price;
skill.level++;
if(id === "hp"){
player.max = player.baseMax + (skill.level * 20);
player.hp = Math.min(player.hp + 20, player.max);
}
update();
toastMsg(`‚úÖ ${id} upgraded to level ${skill.level}!`);
openSkills();
} else {
toastMsg("‚ùå Not enough coins!");
}
}

function openStats(){
const modal = document.getElementById('statsModal');
const list = document.getElementById('statsList');
list.innerHTML = "";

let stats = [
{label: "Player Level", value: player.level},
{label: "Total Kills", value: player.kills},
{label: "Coins Earned", value: player.coinsEarned},
{label: "Total Gems", value: player.gems},
{label: "VIP Tier", value: vipTiers[player.vipTier].name},
{label: "VIP Bonus", value: `+${player.vipBonus}% coins`},
{label: "Current Energy", value: `${player.energy}/${player.energyMax}`},
{label: "Current Weapon", value: weapons[player.weapon].name},
{label: "Current Character", value: characters[player.char].name},
{label: "Referrals", value: player.referrals}
];

stats.forEach(s => {
let div = document.createElement("div");
div.className = "stat-row";
div.innerHTML = `<span class="label">${s.label}</span><span class="value">${s.value}</span>`;
list.appendChild(div);
});

// Add withdrawal button
let withdrawDiv = document.createElement("div");
withdrawDiv.style.marginTop = "20px";
withdrawDiv.innerHTML = `<button onclick="openWithdrawal()" style="width:100%;padding:12px;background:#ffc107;color:#000;font-weight:bold;">
üí∞ Withdraw TON
</button>`;
list.appendChild(withdrawDiv);

modal.classList.add("show");
}

function openSettings(){
const modal = document.getElementById('settingsModal');
const list = document.getElementById('settingsList');
list.innerHTML = "";

list.innerHTML = `
<div class="setting-item">
<label>
<span>üîä Sound Effects</span>
<input type="checkbox" id="soundToggle" ${player.soundEnabled ? "checked" : ""} onchange="toggleSound()">
</label>
</div>
<div class="setting-item">
<label>
<span>üë§ Player Name</span>
</label>
<input type="text" id="playerNameInput" value="${player.name}" placeholder="Enter your name">
<button onclick="changeName()" style="width:100%;margin-top:8px">Change Name</button>
</div>
<div class="setting-item">
<label>
<span>üíæ Game Data</span>
</label>
<button onclick="exportSave()" style="width:100%;margin-top:8px;background:#4caf50">Export Save</button>
<button onclick="importSave()" style="width:100%;margin-top:8px;background:#2196f3">Import Save</button>
<button onclick="openModal('confirmModal')" style="width:100%;margin-top:8px;background:#ff5252">Reset Game</button>
</div>
<div class="setting-item">
<label>
<span>üì± About</span>
</label>
<p style="font-size:12px;color:#aaa;margin-top:8px;">
Zombie Fighter - TON Edition v1.2<br>
With Energy & VIP Systems
</p>
</div>
`;

modal.classList.add("show");
}

function toggleSound(){
player.soundEnabled = !player.soundEnabled;
update();
toastMsg(player.soundEnabled ? "üîä Sound ON" : "üîá Sound OFF");
}

function changeName(){
let newName = document.getElementById("playerNameInput").value.trim();
if(newName.length > 0){
player.name = newName;
update();
toastMsg("‚úÖ Name changed!");
} else {
toastMsg("‚ùå Name cannot be empty!");
}
}

function exportSave(){
let data = JSON.stringify({
player: player,
skills: skills
});
navigator.clipboard.writeText(data).then(() => {
toastMsg("‚úÖ Game data copied to clipboard!");
});
}

function importSave(){
let data = prompt("Paste your save data:");
if(data){
try{
let parsed = JSON.parse(data);
Object.assign(player, parsed.player);
Object.assign(skills, parsed.skills);
update();
toastMsg("‚úÖ Game data imported!");
} catch(e){
toastMsg("‚ùå Invalid save data!");
}
}
}

function confirmReset(){
player = {
hp: 100,
max: 100,
baseMax: 100,
hpUpgrades: 0,
coins: 0,
gems: 0,
level: 1,
xp: 0,
xpMax: 100,
energy: 100,
energyMax: 100,
weapon: "sword",
char: "hero",
name: "Player",
kills: 0,
coinsEarned: 0,
referrals: 0,
referralCode: "",
ownedWeapons: ["sword"],
ownedChars: ["hero"],
soundEnabled: true,
vipTier: 0,
vipBonus: 0
};
skills = {
damage: {level: 0, max: 5},
hp: {level: 0, max: 5},
crit: {level: 0, max: 3}
};
zombie = {hp: 30, max: 30};
update();
closeModal('confirmModal');
toastMsg("‚úÖ Game reset!");
}

function openReferral(){
const modal = document.getElementById('referralModal');
const content = document.getElementById('referralContent');
content.innerHTML = `
<h3>Invite Friends & Earn!</h3>
<p style="color:#aaa;font-size:14px;">Share your code with friends to earn rewards when they join!</p>
<div class="referral-code">
<div>Your Referral Code:</div>
<div class="code">${player.referralCode}</div>
<button onclick="copyReferralCode()" style="width:100%;padding:10px;background:#4caf50;color:#fff;border:none;border-radius:8px;">
üìã Copy Code
</button>
</div>
<div style="margin-top:20px;background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;">
<h4 style="margin-top:0;color:#ffc107;">Rewards</h4>
<p style="font-size:14px;color:#aaa;">‚Ä¢ Each referral: +100üí∞</p>
<p style="font-size:14px;color:#aaa;">‚Ä¢ 10 referrals: +10üíé</p>
<p style="font-size:14px;color:#aaa;">‚Ä¢ Your friends get +50üí∞ bonus</p>
</div>
<p style="text-align:center;color:#aaa;margin-top:20px;font-size:12px;">
Total Referrals: <span style="color:#4caf50;font-weight:bold;">${player.referrals}</span>
</p>
`;
modal.classList.add('show');
}

function copyReferralCode(){
navigator.clipboard.writeText(player.referralCode).then(() => {
toastMsg("‚úÖ Referral code copied!");
});
}

function openSpinWheel(){
const modal = document.getElementById('spinModal');
const wheel = document.getElementById('wheel');
wheel.innerHTML = "";

// Create wheel slices
for(let i=0;i<8;i++){
let slice = document.createElement("div");
slice.className = "wheel-slice";
slice.style.transform = `rotate(${i * 45}deg)`;
slice.style.backgroundColor = wheelColors[i];
slice.innerHTML = `<div style="transform:rotate(45deg)">${wheelPrizes[i]}üí∞</div>`;
wheel.appendChild(slice);
}

// ‚ú® FEATURE 5: Update wheel center with ninja image
const wheelCenterImage = document.getElementById('wheelCenterImage');
if (wheelCenterImage) {
wheelCenterImage.src = characters.ninja.image;
}

modal.classList.add('show');
}

function spinWheel(){
if(isSpinning) return;
isSpinning = true;

const wheel = document.getElementById('wheel');
const spinButton = document.getElementById('spinButton');
const result = document.getElementById('spinResult');

spinButton.disabled = true;
result.textContent = "";

// Random prize selection
let prizeIndex = Math.floor(Math.random() * wheelPrizes.length);
let prize = wheelPrizes[prizeIndex];

// Calculate rotation (multiple full rotations + prize offset)
let rotations = 5;
let targetAngle = rotations * 360 + (360 - (prizeIndex * 45) - 22.5);

wheel.style.transform = `rotate(${targetAngle}deg)`;
sounds.play('spin');

setTimeout(() => {
// ‚ú® FEATURE 3: Apply VIP bonus to wheel prizes
let finalPrize = prize;
if (prize > 0) {
finalPrize = applyVIPBonus(prize);
player.coins += finalPrize;
player.coinsEarned += finalPrize;
update();
}

result.textContent = `üéâ You won ${finalPrize} coins!${player.vipBonus > 0 && prize > 0 ? ` (VIP +${player.vipBonus}%)` : ''}`;
if(prize === 0){
result.textContent = "üòÖ Better luck next time!";
}

isSpinning = false;
spinButton.disabled = false;
}, 3500);
}

// Initialize
window.onload = function(){
initSounds();
loadGame();
openSpinWheel(); // Initialize wheel

// ‚ú® FEATURE 4: Add event listener for withdrawal amount input
const withdrawAmountInput = document.getElementById('withdrawAmount');
if (withdrawAmountInput) {
withdrawAmountInput.addEventListener('input', updateWithdrawalSummary);
withdrawAmountInput.addEventListener('change', updateWithdrawalSummary);
}
};

// Close modal when clicking outside
window.onclick = function(event){
if(event.target.classList.contains('modal')){
event.target.classList.remove('show');
}
}
</script>
</body>
</html>
